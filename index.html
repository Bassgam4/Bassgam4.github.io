<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Medibot</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  background: linear-gradient(to bottom right, #e0f2f1, #b2dfdb);
}
.menu-btn.active {
  background-color: #0d9488;
  color: white;
}
</style>

</head>

<body class="p-6">

<h1 class="text-4xl font-bold text-teal-700 text-center mb-8"> Panel Admin â€“ Medibot</h1>

<div class="flex justify-center gap-4 mb-8">
    <button class="menu-btn px-4 py-2 bg-white rounded-lg shadow hover:bg-teal-100" onclick="show('buscar')">ğŸ” Buscar estudiante</button>
    <button class="menu-btn px-4 py-2 bg-white rounded-lg shadow hover:bg-teal-100" onclick="show('asociar')">ğŸ‘¤ Asociar matrÃ­cula</button>
    <button class="menu-btn px-4 py-2 bg-white rounded-lg shadow hover:bg-teal-100" onclick="show('lista')">ğŸ“„ Lista completa</button>
</div>


<div id="buscar" class="section hidden max-w-2xl mx-auto bg-white p-6 rounded-2xl shadow-xl border border-teal-300">
    <h2 class="text-2xl font-semibold text-teal-700 mb-4"> Buscar estudiante</h2>

    <input id="buscarMat" placeholder="Escribe matrÃ­cula"
        class="w-full p-3 border rounded-lg mb-4 focus:ring-2 focus:ring-teal-500">

    <button onclick="buscarEst()"
        class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700">Buscar</button>

    <div id="resultadoBuscar" class="mt-6"></div>
</div>


<div id="asociar" class="section hidden max-w-xl mx-auto bg-white p-6 rounded-2xl shadow-xl border border-teal-300">
    <h2 class="text-2xl font-semibold text-teal-700 mb-4"> Asociar matrÃ­cula con nombre</h2>

    <input id="asMat" placeholder="MatrÃ­cula"
        class="w-full p-3 border mb-4 rounded-lg focus:ring-2 focus:ring-teal-500">

    <input id="asNom" placeholder="Nombre del estudiante"
        class="w-full p-3 border mb-4 rounded-lg focus:ring-2 focus:ring-teal-500">

    <button onclick="asociarNombre()"
        class="bg-teal-600 text-white w-full py-2 rounded-lg hover:bg-teal-700">Guardar asociaciÃ³n</button>

    <p id="asMsg" class="mt-4 text-teal-700 font-semibold"></p>
</div>


<div id="lista" class="section hidden max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow-xl border border-teal-300">
    <h2 class="text-2xl font-semibold text-teal-700 mb-4">ğŸ“„ Lista completa de estudiantes</h2>

    <button onclick="cargarLista()"
        class="mb-4 bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600">Actualizar lista</button>

    <div id="tablaLista"></div>
</div>



<script>
 const firebaseConfig = {
    apiKey: "AIzaSyB6MzvXECB-kp83HPMQBZI8M7c-x5gST5w",
    authDomain: "practicaesp32-5b317.firebaseapp.com",
    databaseURL: "https://practicaesp32-5b317-default-rtdb.firebaseio.com",
    projectId: "practicaesp32-5b317",
    storageBucket: "practicaesp32-5b317.firebasestorage.app",
    messagingSenderId: "274551705526",
    appId: "1:274551705526:web:73746b3bcf6e480e543b17",
    measurementId: "G-9J47PZ5115"
  };

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const base = "Estudiantes";

function show(id) {
  document.querySelectorAll(".section").forEach(e => e.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");

  document.querySelectorAll(".menu-btn").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
}



function buscarEst() {
    const m = document.getElementById("buscarMat").value.trim();
    const out = document.getElementById("resultadoBuscar");

    if (!m) return alert("Ingresa una matrÃ­cula");

    db.ref(`${base}/${m}`).once("value", snap => {
        const data = snap.val();

        if (!data) {
            out.innerHTML = `<p class="text-red-600 font-semibold">No existe esta matrÃ­cula</p>`;
            return;
        }

        let html = `
            <div class="p-4 bg-teal-50 rounded-xl border border-teal-300">
                <h3 class="text-xl font-semibold text-teal-700">ğŸ‘¤ ${data.nombre || "Sin nombre asignado"}</h3>
                <p class="text-gray-700"><b>MatrÃ­cula:</b> ${m}</p>
                <h4 class="font-semibold text-teal-600 mt-3">Respuestas:</h4>
        `;

        Object.keys(data).forEach(k => {
            if (k.startsWith("r"))
                html += `<p class="text-gray-700"><b>${k}:</b> ${data[k]}</p>`;
        });

        html += `</div>`;

        out.innerHTML = html;
    });
}

function asociarNombre() {
    const m = document.getElementById("asMat").value.trim();
    const n = document.getElementById("asNom").value.trim();
    const msg = document.getElementById("asMsg");

    if (!m || !n) return alert("Completa todos los campos");

    db.ref(`${base}/${m}/nombre`).set(n).then(() => {
        msg.innerText = "Nombre guardado correctamente âœ”";
    });
}



function cargarLista() {
    db.ref(base).once("value", snap => {

        let html = `
        <table class="w-full border-collapse">
            <tr class="bg-teal-600 text-white">
                <th class="p-2 border">MatrÃ­cula</th>
                <th class="p-2 border">Nombre</th>
                <th class="p-2 border">Respuestas</th>
            </tr>
        `;

        snap.forEach(est => {
            const m = est.key;
            const val = est.val();
            const nombre = val.nombre || "Sin nombre";

            let resp = "";
            Object.keys(val).forEach(k => {
                if (k.startsWith("r")) resp += `<b>${k}:</b> ${val[k]}<br>`;
            });

            html += `
            <tr class="border hover:bg-teal-50">
                <td class="p-2 border">${m}</td>
                <td class="p-2 border">${nombre}</td>
                <td class="p-2 border">${resp}</td>
            </tr>
            `;
        });

        html += `</table>`;

        document.getElementById("tablaLista").innerHTML = html;
    });
}
</script>

</body>
</html>
